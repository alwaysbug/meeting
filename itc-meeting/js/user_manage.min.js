function myCompany(a){a.data.user.companies.length>1&&$(".down_arrow").show(),$(".company").html(a.data.user.companies[0].companyName),$(".user").html(a.data.user.user.nickname)}function groupAll(a){var b,c,d,e,f,g,h,i;$("#zTree").children().remove(),b=a.data,c=[],d={name:b.companyName,open:!0,dataId:"0"},e=JSON.stringify(a),f=e.split('"groups":')[1].split('},"message"')[0],g=f.replace(/\"id\"/g,'"dataId"'),h=JSON.parse(g),d.children=h,c.push(d),$.fn.zTree.init($("#zTree"),setting,c),tree=$.fn.zTree.getZTreeObj("zTree"),i=tree.getNodeByParam("dataId",0,null),clickNode(event,zTree,i),tree.selectNode(i)}function clickNode(a,b,c){var d,e,f,g,h,i,j,m;for($("#company_title").html(c.name),0==c.dataId||-1==c.dataId?$(".edit_depart_name").hide():$(".edit_depart_name").show(),d=$(".breadcrumb"),d.children().remove(),e=c,f=e,g=0;g<c.level;g++)f=f.getParentNode(),h=$('<li><a href="javascript:;" dataId="'+f.dataId+'">'+f.name+"</a></li>"),d.prepend(h);i=$('<li class="active">'+c.name+"</li>"),d.append(i),groupObj=c,j={parent_id:c.dataId,activated:"0"},$(".department"),$(".persons"),m=$(".person_list"),api.get("group/children",j,function(a){var c,d,e,f,g,h,i,b=a.data.groups;if($(".depart_lists_add").children().remove(),0==b.length)c=$('<tr><td colspan="2" style="text-align: center;">无子部门</td></tr>'),departTbody.append(c);else for(d=0;d<b.length;d++)c=$('<tr data-group-id="'+b[d].id+'"><td>'+b[d].name+'<span class="glyphicon glyphicon-chevron-right right_icon"></span></td></tr>'),departTbody.append(c);if(e=a.data.members,m.children().remove(),0==e.length)c=$('<tr><td colspan="6" style="text-align: center;width: 900px;height: 50px;border-bottom: 1px solid #f2f2f2;">此部门暂无成员</td></tr>'),m.append(c);else for(d=0;d<e.length;d++)f="M"==e[d].gender?"男":"女",g=e[d].status,h="",i="",0==g||1==g?(h="等待加入",i="activetion noVefied"):2==g?(h="已加入",i="activetion joined"):3==g?(h="已拒绝",i="activetion refuse"):4==g?(h="已移除",i="activetion removed"):(h="激活",i="activetion waitActived"),c=$('<tr member-id="'+e[d].id+'"><td><input type="checkbox" class="check"/></td><td class="clickTr">'+e[d].nickname+'</td><td class="clickTr">'+f+'</td><td class="clickTr">'+e[d].jobTitle+'</td><td class="clickTr">'+e[d].contact+'</td><td><button class="'+i+'">'+h+"</button></td></tr>"),m.append(c);checkOrCancel(".checkAll",".check")})}function upLoad(){$("#hiddenIn").val(groupObj.dataId);var a={headers:{Authorization:api.checkCookieOrSession()},url:api.host+"user/import",dataType:"json",success:function(a){0==a.code?($(".tips_text").html("批量导入成功！"),$("#no_groups").modal("show"),delayDisapper(800),clickNode(event,zTree,groupObj),api.get("group/tree",{},groupAll),$("#fileToUpload").val(""),slideHide()):($(".tips_text").html(a.message),$("#no_groups").modal("show"),delayDisapper(800),clickNode(event,zTree,groupObj),$("#fileToUpload").val(""),slideHide())}};$("#myForm").ajaxSubmit(a)}function delayDisapper(a){setTimeout(function(){$("#no_groups").modal("hide")},a)}function sexVal(a){return"M"===a.gender?"1":"2"}function slideShow(a){slideMask.show(),a.show(),slideDiv.animate({right:"0"},250)}function slideHide(){slideMask.hide(),slideDiv.animate({right:"-500"},250),setTimeout(function(){slideDiv.hide()},250)}function checkOrCancel(a,b){var c=$(a),d=$(b);c.on("click",function(){d.prop("checked",$(this).prop("checked"))}),d.on("click",function(){$(b+":checked").length==d.length?c.prop("checked",!0):c.prop("checked",!1)})}var departTbody,groupsId,groupObj,tree,setting,tableListTr,personListTr,tableList,editUsrId,tipsSlideSpeed,$clear_val,$search,slide_speed,slideDiv,slideMask;api.userPost("user/me",{},myCompany),$(".user_loginOut_icon").on("click",function(){$("#login_out").modal("show")}),$(".login_out_btn").on("click",function(){api.userPost("auth/logout",{},function(){window.location.href="register.html?login"})}),departTbody=$(".depart_lists_add"),groupsId="0",groupObj={},api.get("group/tree",{},groupAll),tree=null,setting={view:{showIcon:!1,showTitle:!1,showLine:!1},callback:{onClick:clickNode},data:{simpleData:{enable:!0}}},tableListTr=$(".depart_lists_add"),tableListTr.on("mouseover","tr",function(){$(this).attr("data-group-id")&&(tableList.children().css("backgroundColor","#ffffff"),$(this).css("backgroundColor","rgba(236, 239, 244,0.7)"))}),tableListTr.on("mouseout","tr",function(){tableList.children().css("backgroundColor","#ffffff")}),personListTr=$(".person_list"),personListTr.on("mouseover","tr",function(){$(this).attr("member-id")&&(personListTr.children().css("backgroundColor","#ffffff"),$(this).css("backgroundColor","rgba(236, 239, 244,0.7)"))}),personListTr.on("mouseout","tr",function(){personListTr.children().css("backgroundColor","#ffffff")}),tableList=$(".depart_lists_add"),tableList.on("click","tr",function(){if($(this).attr("data-group-id")){var a=tree.getNodeByParam("dataId",$(this).attr("data-group-id"));clickNode(event,zTree,a,null),tree.expandNode(a,!0,!1,!1),tree.selectNode(a)}}),$(".breadcrumb").on("click","a",function(){var a=tree.getNodeByParam("dataId",$(this).attr("dataId"),null);tree.selectNode(a),clickNode(event,zTree,a),tree.expandNode(a,!1,!0,!1)}),$(".search").on("input",function(){if(""==$(".search").val())api.get("group/tree",{},groupAll);else{var a={q:$(".search").val()};api.get("group/all",a,function(a){var b,c,d;$("#zTree").children().remove(),b=a.data.data,c=JSON.stringify(b),d=JSON.parse(c.replace(/\"id\"/g,'"dataId"')),console.log(d),$.fn.zTree.init($("#zTree"),setting,d)})}}),$(".add_usr_child").on("click",function(){$(".sidebar").hide(),slideShow($(".add_usr_silde"))}),$(".user_create").on("click",function(){var a={nickname:$(".name").val(),role_id:$(".role option:selected").val(),serial_no:$(".serial_no").val(),mobile:$(".phone").val(),job_title:$(".job").val(),group_id:groupObj.dataId,gender:1==$(".sex option:selected").val()?"M":"F"};api.userPost("user/create",a,function(a){0==a.code?($(".sidebar").hide(),$(".tips_text").html("添加成功"),$("#no_groups").modal("show"),delayDisapper(800),clickNode(event,zTree,groupObj)):($(".tips_text").html(a.message),$("#no_groups").modal("show"),delayDisapper(800))})}),$(".user_delete_cancel").on("click",function(){$(".name").val(""),$(".serial_no").val(""),$(".phone").val(""),$(".job").val(""),slideHide()}),$(".add_depart_child").on("click",function(){$(".sidebar").hide(),slideShow($(".add_departs_silde"))}),$(".add_departs_save").on("click",function(){var a=$(".depart_name").val(),b={name:a,description:$(".description").val(),parent_id:groupObj.dataId};api.userPost("group/create",b,function(b){if(0==b.code){slideHide();var c={name:a,dataId:b.data,parent_id:groupObj.dataId};tree.addNodes(groupObj,c),$(".depart_name").val(""),$(".description").val("")}else $(".tips_text").html(b.message),$("#no_groups").modal("show"),delayDisapper(800)})}),$(".add_departs_cancel").on("click",function(){slideHide(),$(".depart_name").val(""),$(".description").val("")}),$(".edit_depart_name").on("click",function(){$(".sidebar").hide(),$(".depart_change_name").val(""),$(".description_change").val("");var a={group_id:groupObj.dataId};api.get("group/briefInfo",a,function(a){var b=a.data;$(".depart_change_name").val(b.name),$(".description_change").val(b.description)}),slideShow($(".change_departs_silde"))}),$(".change_departs_delete").on("click",function(){$(".depart_change_name").val(""),slideHide()}),$(".departs_delete").on("click",function(){$(".delete_groups").modal("show")}),$(".delete_this_group").on("click",function(){var a={id:groupObj.dataId};api.deleteIt("group/delete",a,function(a){var b,c;0==a.code?($(".tips_text").html(a.message),$("#no_groups").modal("show"),b=tree.getNodeByParam("dataId",groupObj.dataId,null),c=b.getPreNode()||b.getNextNode()||b.getParentNode(),tree.removeNode(b),clickNode(event,zTree,c),tree.selectNode(c),delayDisapper(800),$(".depart_change_name").val(""),slideHide()):($(".tips_text").html(a.message),$("#no_groups").modal("show"),delayDisapper(800))}),$("#delete_groups").modal("hide")}),$(".change_departs_save").on("click",function(){var a={name:$(".depart_change_name").val(),description:$(".description_change").val(),parent_id:groupObj.parent_id,id:groupObj.dataId};api.userPost("group/update",a,function(a){0==a.code?(slideHide(),api.asyncGet("group/tree",{},groupAll)):($(".tips_text").html(a.message),$("#no_groups").modal("show"),delayDisapper(800))})}),$(".uoload_user_btn").on("click",function(){$(".sidebar").hide(),slideShow($(".upload_users"))}),$(".delete_more_users").on("click",function(){var a=$(".check:checked");return 0==a.length?($(".tips_text").html("您未选择任何成员"),$("#no_groups").modal("show"),delayDisapper(800),void 0):($(".delete_users_checked").modal("show"),void 0)}),$(".delete_these_users").on("click",function(){var b,c,a=$(".check:checked");for(b=0;b<a.length;b++)c={uid:a.eq(b).parent().parent().attr("member-id"),group_id:groupObj.dataId},api.userPost("user/removeFromGroup",c,function(b){0==b.code?($(".tips_text").html(b.message),$("#no_groups").modal("show"),delayDisapper(800),a.parent().parent().remove(),$(".check:checked").length==$(".check").length&&0!=$(".check").length?$(".checkAll").prop("checked",!0):$(".checkAll").prop("checked",!1)):($(".tips_text").html(b.message),$("#no_groups").modal("show"),delayDisapper(800))});$(".delete_users_checked").modal("hide")}),$(".delete_more_depart").on("click",function(){var a=$(".depart_lists_add input[type=checkbox]:checked");return 0==a.length?($(".tips_text").html("您未选择任何部门"),$("#no_groups").modal("show"),delayDisapper(800),void 0):($(".delete_groups_checked").modal("show"),void 0)}),$(".delete_these_group").on("click",function(){var b,c,a=$(".depart_lists_add input[type=checkbox]:checked");for($(".delete_groups_checked").modal("hide"),b=0;b<a.length;b++)c={id:a.eq(b).parent().parent().attr("data-group-id")},api.deleteIt("group/delete",c,function(c){if(0==c.code){$(".tips_text").html(c.message),$("#no_groups").modal("show"),delayDisapper(800);var d=tree.getNodeByParam("dataId",a.eq(b).parent().parent().attr("data-group-id"),null);tree.removeNode(d),a.parent().parent().remove()}else $(".tips_text").html(c.message),$("#no_groups").modal("show"),delayDisapper(800)})}),editUsrId=null,$(".new_person_list_table").on("click",".clickTr",function(){$(".sidebar").hide(),slideShow($(".edit_usr_silde")),editUsrId=$(this).parent().attr("member-id"),$(".e_group").html(""),$(".e_name").val(""),$(".e_phone").val(""),$(".e_job").val(""),$(".e_serial_no").val(""),api.get("group/lists",{},function(a){var c,d,e,b=a.data;for(c=1;c<b.length;c++)d=$('<option value="'+b[c].id+'">'+b[c].name+"</option>"),$(".e_group").append(d);-1==groupObj.dataId&&(e=$('<option value="0"></option>'),$(".e_group").prepend(e)),api.get("companyUser/info",{id:editUsrId},function(a){var c,b=a.data;console.log(b),$(".e_name").val(b.nickname),c=sexVal(b),console.log(c),$('.e_sex option[value="'+c+'"]').prop("selected",!0),$(".e_phone").val(b.mobile),$(".e_job").val(b.jobTitle),$('.e_group option[value="'+b.groupId+'"]').prop("selected",!0),$(".e_serial_no").val(b.serialNo),$('.e_role option[value="'+b.roleId+'"]').prop("selected",!0)})})}),$(".e_user_create").on("click",function(){var a={id:editUsrId,nickname:$(".e_name").val(),gender:1==$(".e_sex option:selected").val()?"M":"F",mobile:$(".e_phone").val(),role_id:$(".e_role option:selected").val(),job_title:$(".e_job").val(),group_id:$(".e_group option:selected").val(),serial_no:$(".e_serial_no").val()};api.userPost("companyUser/updateEmployee",a,function(a){0==a.code?($(".tips_text").html("修改成功"),$("#no_groups").modal("show"),delayDisapper(800),$(".e_name").val(""),$(".e_phone").val(""),$(".e_job").val(""),$(".e_serial_no").val(""),clickNode(event,zTree,groupObj),slideHide()):($(".tips_text").html(a.message),$("#no_groups").modal("show"),delayDisapper(800),slideHide())})}),$(".e_user_delete_cancel").on("click",function(){slideHide()}),tipsSlideSpeed=200,$(".user_news_icon").on("click",function(){$(".person_sets").slideUp(tipsSlideSpeed),$(".companys").slideUp(tipsSlideSpeed),$(".person_tips").slideToggle(tipsSlideSpeed)}),$(".user_set_icon").on("click",function(){$(".person_tips").slideUp(tipsSlideSpeed),$(".companys").slideUp(tipsSlideSpeed),$(".person_sets").slideToggle(tipsSlideSpeed)}),$(".down_arrow").on("click",function(){$(".person_sets").slideUp(tipsSlideSpeed),$(".person_tips").slideUp(tipsSlideSpeed),$(".companys").slideToggle(tipsSlideSpeed)}),$(".companys").on("click","li",function(){$(".companys").slideUp(tipsSlideSpeed)}),$(".wrap").on("click",function(){$(".tips").slideUp(tipsSlideSpeed),$(".companys").slideUp(tipsSlideSpeed)}),$(".slide-wrapper").on("click",function(a){a.stopPropagation(),$(".tips").slideUp(tipsSlideSpeed)}),$(".sureChange").on("click",function(){var a={old_password:$(".oldpassword").val(),new_password:$(".newpassword").val()};api.userPost("user/password",a,function(a){$(".tips_text").html(a.message),$("#no_groups").modal("show"),delayDisapper(800),$(".tips").slideUp(200)})}),$clear_val=$(".clear_val"),$search=$(".search"),slide_speed=100,$search.on("input",function(){""!=$(this).val()?$clear_val.slideDown(slide_speed):$clear_val.slideUp(slide_speed)}),$clear_val.on("click",function(){$search.val(""),$clear_val.slideUp(slide_speed),api.get("group/tree",{},groupAll)}),slideDiv=$(".sidebar"),slideMask=$(".slide-mask"),slideMask.on("click",function(){slideHide()});