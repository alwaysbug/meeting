/**
 * Created by root on 2017/3/28.
 */
function todayMeeting(a){var b=echarts.init(document.getElementById("precent"));option={tooltip:{trigger:"item",formatter:"{b}: {c}",axisPointer:{z:"100"}},legend:{orient:"horizontal",left:"center",top:"bottom",data:["已完成","预约会议数"]},series:[{name:"今日会议",type:"pie",radius:["70%","80%"],avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1,textStyle:{fontSize:"30",fontWeight:"bold"}}},labelLine:{normal:{show:!1}},data:[{value:a[1],name:"预约会议数",itemStyle:{normal:{color:"#cee7f6"}}},{value:a[0],name:"已完成",itemStyle:{normal:{color:"#0b89d0"}}}]}]},b.setOption(option)}function systemTime(){function g(a){return 10>a?(e={prefix:"0"},"0"+a):a}function h(a){return 10>a?(f={prefix:"0"},"0"+a):a}var e,f,a=new Date,b=a.getHours(),c=a.getMinutes();a.getSeconds(),e={},f={},b=g(b),c=h(c),time_bool&&(new CountUp("hour_time",0,b,0,1.5,e).start(),new CountUp("minute_time",0,c,0,1.5,f).start(),time_bool=!1),$hourTime.html(b),$minuteTime.html(c)}function barTable(a,b){var c=echarts.init(document.getElementById("bar_table")),d={color:["#3398DB"],tooltip:{trigger:"axis",formatter:"{b}: {c}%",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:a,axisTick:{alignWithLabel:!0,inside:!0}}],yAxis:[{type:"value",min:0,max:100,axisLabel:{formatter:"{value}% "}}],dataZoom:[{type:"inside",start:0,end:60},{type:"slider",show:!0,start:0,end:60,bottom:"0px"}],series:[{name:"使用频率",type:"bar",barCategoryGap:"60%",data:b}]};c.setOption(d)}function checkOrCancel(a,b){var c=$(a),d=$(b);c.on("click",function(){d.prop("checked",$(this).prop("checked"))}),d.on("click",function(){$(b+":checked").length==d.length?c.prop("checked",!0):c.prop("checked",!1)})}function firstTimeBarTable(){var a=new Date,b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),e={day:b+"-"+c+"-"+d};api.get("stat/dailyMeetingRoomUsage",e,function(a){var b=a.data;barTable(b.horizontalRooms,b.verticalPercentage)})}function myCompany(a){a.data.user.companies.length>1&&$(".down_arrow").show(),$(".company").html(a.data.user.companies[0].companyName),$(".user").html(a.data.user.user.nickname)}function delayDisapper(a){setTimeout(function(){$("#no_groups").modal("hide")},a)}function monthMeet(a){var g,h,b=new Date,c=b.getFullYear(),d=b.getMonth()+1,e=a.data,f=[];for(g=0;g<e.length;g++)h={date:c+"/"+d+"/"+e[g],value:" "},f.push(h);$("#ca").calendar({width:450,height:220,data:f,onSelected:function(a,b){var d=new Date(b).Format("yyyy-MM-dd"),e=d.split("-")[0],f=d.split("-")[1],g=d.split("-")[2],h={year:e,month:f,day:g};api.get("meeting",h,selectedDay),api.get("stat/dailyMeetingRoomUsage",{day:d},function(a){var b=a.data;barTable(b.horizontalRooms,b.verticalPercentage)})}})}function selectedDay(a){var c,d,e,b=$(".tbody");if(b.slideUp(),b.html(""),c=a.data,$("#today_num").html(c.length),0==c.length)d=$('<tr><td colspan="5" style="text-align: center;">今日没有会议，快去添加吧</td></tr>'),b.append(d);else for(e=0;e<c.length;e++)d=$("<tr><td>"+c[e].subject+"</td><td>"+c[e].attendedNum+"</td><td>"+c[e].roomAddress+"</td><td>"+c[e].startedAt.split(" ")[1]+"-"+c[e].endedAt.split(" ")[1]+"</td><td>"+c[e].summary+"</td></tr>"),b.append(d);b.slideDown()}var getTodayMeet,tipsSlideSpeed,nowTime,year,month,meetParam,$nowTime=$(".now_time_content"),time_bool=!0,$hourTime=$("#hour_time"),$minuteTime=$("#minute_time");setInterval(systemTime,100),checkOrCancel(".checkAll",".check"),api.get("stat/daily",{},function(a){var b,c;0==a.code&&(b=a.data,$("#ing_num").html(b.appointedMeetingNum),$("#free_num").html(b.canceledMeetingNum),$("#today_num").html(b.attendedNum),$("#total_num").html(b.spareRoomNum),c=1.5,new CountUp("ing_num",0,b.appointedMeetingNum,0,c).start(),new CountUp("free_num",0,b.canceledMeetingNum,0,c).start(),new CountUp("today_num",0,b.attendedNum,0,c).start(),new CountUp("total_num",0,b.spareRoomNum,0,c).start(),todayMeeting([b.alreadyEndedMeetingNum,b.appointedMeetingNum]))}),firstTimeBarTable(),getTodayMeet={init:function(){var a=new Date,b={year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate()};api.get("meeting",b,getTodayMeet.backObj)},backObj:function(a){var d,e,b=$(".tbody"),c=a.data;if($("#today_num").html(c.length),0==c.length)d=$("<tr><td>今日没有会议，快去添加吧</td></tr>"),b.append(d);else for(e=0;e<c.length;e++)d=$("<tr><td>"+c[e].subject+"</td><td>"+c[e].attendedNum+"</td><td>"+c[e].roomAddress+"</td><td>"+c[e].startedAt.split(" ")[1]+"-"+c[e].endedAt.split(" ")[1]+"</td><td>"+c[e].summary+"</td></tr>"),b.append(d)}},getTodayMeet.init(),api.userPost("user/me",{},myCompany),$(".user_loginOut_icon").on("click",function(){$("#login_out").modal("show")}),$(".login_out_btn").on("click",function(){api.userPost("auth/logout",{},function(){window.location.href="register.html?login"})}),tipsSlideSpeed=200,$(".user_news_icon").on("click",function(){$(".person_sets").slideUp(tipsSlideSpeed),$(".companys").slideUp(tipsSlideSpeed),$(".person_tips").slideToggle(tipsSlideSpeed)}),$(".user_set_icon").on("click",function(){$(".person_tips").slideUp(tipsSlideSpeed),$(".companys").slideUp(tipsSlideSpeed),$(".person_sets").slideToggle(tipsSlideSpeed)}),$(".down_arrow").on("click",function(){$(".person_sets").slideUp(tipsSlideSpeed),$(".person_tips").slideUp(tipsSlideSpeed),$(".companys").slideToggle(tipsSlideSpeed)}),$(".companys").on("click","li",function(){$(".companys").slideUp(tipsSlideSpeed)}),$(".wrapper").on("click",function(){$(".tips").slideUp(tipsSlideSpeed),$(".companys").slideUp(tipsSlideSpeed)}),$(".slide-wrapper").on("click",function(){$(".tips").slideUp(tipsSlideSpeed)}),$(".sureChange").on("click",function(){var a={old_password:$(".oldpassword").val(),new_password:$(".newpassword").val()};api.userPost("user/password",a,function(a){$(".tips_text").html(a.message),$("#no_groups").modal("show"),delayDisapper(1e3),$(".tips").slideUp(200)})}),nowTime=new Date,year=nowTime.getFullYear(),month=nowTime.getMonth(),meetParam={year:year,month:month+1},api.get("meeting/meetingDays",meetParam,monthMeet),Date.prototype.Format=function(a){var c,b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(c in b)new RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[c]:("00"+b[c]).substr((""+b[c]).length)));return a};